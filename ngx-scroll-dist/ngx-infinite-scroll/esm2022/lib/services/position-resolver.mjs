export function createResolver({ windowElement, axis, }) {
    return createResolverWithContainer({ axis, isWindow: isElementWindow(windowElement) }, windowElement);
}
export function createResolverWithContainer(resolver, windowElement) {
    const container = resolver.isWindow || (windowElement && !windowElement.nativeElement)
        ? windowElement
        : windowElement.nativeElement;
    return { ...resolver, container };
}
export function isElementWindow(windowElement) {
    const isWindow = ['Window', 'global'].some((obj) => Object.prototype.toString.call(windowElement).includes(obj));
    return isWindow;
}
export function getDocumentElement(isContainerWindow, windowElement) {
    return isContainerWindow ? windowElement.document.documentElement : null;
}
export function calculatePoints(element, resolver) {
    const height = extractHeightForElement(resolver);
    return resolver.isWindow
        ? calculatePointsForWindow(height, element, resolver)
        : calculatePointsForElement(height, element, resolver);
}
export function calculatePointsForWindow(height, element, resolver) {
    const { axis, container, isWindow } = resolver;
    const { offsetHeightKey, clientHeightKey } = extractHeightPropKeys(axis);
    // scrolled until now / current y point
    const scrolled = height +
        getElementPageYOffset(getDocumentElement(isWindow, container), axis, isWindow);
    // total height / most bottom y point
    const nativeElementHeight = getElementHeight(element.nativeElement, isWindow, offsetHeightKey, clientHeightKey);
    const totalToScroll = getElementOffsetTop(element.nativeElement, axis, isWindow) +
        nativeElementHeight;
    return { height, scrolled, totalToScroll, isWindow };
}
export function calculatePointsForElement(height, element, resolver) {
    const { axis, container } = resolver;
    // perhaps use container.offsetTop instead of 'scrollTop'
    const scrolled = container[axis.scrollTopKey()];
    const totalToScroll = container[axis.scrollHeightKey()];
    return { height, scrolled, totalToScroll, isWindow: false };
}
export function extractHeightPropKeys(axis) {
    return {
        offsetHeightKey: axis.offsetHeightKey(),
        clientHeightKey: axis.clientHeightKey(),
    };
}
export function extractHeightForElement({ container, isWindow, axis, }) {
    const { offsetHeightKey, clientHeightKey } = extractHeightPropKeys(axis);
    return getElementHeight(container, isWindow, offsetHeightKey, clientHeightKey);
}
export function getElementHeight(elem, isWindow, offsetHeightKey, clientHeightKey) {
    if (isNaN(elem[offsetHeightKey])) {
        const docElem = getDocumentElement(isWindow, elem);
        return docElem ? docElem[clientHeightKey] : 0;
    }
    else {
        return elem[offsetHeightKey];
    }
}
export function getElementOffsetTop(elem, axis, isWindow) {
    const topKey = axis.topKey();
    // elem = elem.nativeElement;
    if (!elem.getBoundingClientRect) {
        // || elem.css('none')) {
        return;
    }
    return (elem.getBoundingClientRect()[topKey] +
        getElementPageYOffset(elem, axis, isWindow));
}
export function getElementPageYOffset(elem, axis, isWindow) {
    const pageYOffset = axis.pageYOffsetKey();
    const scrollTop = axis.scrollTopKey();
    const offsetTop = axis.offsetTopKey();
    if (isNaN(window.pageYOffset)) {
        return getDocumentElement(isWindow, elem)[scrollTop];
    }
    else if (elem.ownerDocument) {
        return elem.ownerDocument.defaultView[pageYOffset];
    }
    else {
        return elem[offsetTop];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24tcmVzb2x2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtaW5maW5pdGUtc2Nyb2xsL3NyYy9saWIvc2VydmljZXMvcG9zaXRpb24tcmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsTUFBTSxVQUFVLGNBQWMsQ0FBQyxFQUM3QixhQUFhLEVBQ2IsSUFBSSxHQUNjO0lBQ2xCLE9BQU8sMkJBQTJCLENBQ2hDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxlQUFlLENBQUMsYUFBYSxDQUFDLEVBQUUsRUFDbEQsYUFBYSxDQUNkLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLDJCQUEyQixDQUN6QyxRQUFhLEVBQ2IsYUFBMkI7SUFFM0IsTUFBTSxTQUFTLEdBQ2IsUUFBUSxDQUFDLFFBQVEsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7UUFDbEUsQ0FBQyxDQUFDLGFBQWE7UUFDZixDQUFDLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQztJQUNsQyxPQUFPLEVBQUUsR0FBRyxRQUFRLEVBQUUsU0FBUyxFQUFFLENBQUM7QUFDcEMsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQUMsYUFBMkI7SUFDekQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FDekQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FDNUQsQ0FBQztJQUNGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLGlCQUEwQixFQUMxQixhQUFrQjtJQUVsQixPQUFPLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFB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QU07UUFDTCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztLQUM5QjtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsbUJBQW1CLENBQ2pDLElBQWtCLEVBQ2xCLElBQWtCLEVBQ2xCLFFBQWlCO0lBRWpCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM3Qiw2QkFBNkI7SUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtRQUMvQix5QkFBeUI7UUFDekIsT0FBTztLQUNSO0lBQ0QsT0FBTyxDQUNMLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBQztRQUNwQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUM1QyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxxQkFBcUIsQ0FDbkMsSUFBa0IsRUFDbEIsSUFBa0IsRUFDbEIsUUFBaUI7SUFFakIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzFDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFFdEMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sa0JBQWtCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ3REO1NBQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1FBQzdCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7S0FDcEQ7U0FBTTtRQUNMLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ3hCO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7XHJcbiAgQ29udGFpbmVyUmVmLFxyXG4gIElQb3NpdGlvbkVsZW1lbnRzLFxyXG4gIElQb3NpdGlvblN0YXRzLFxyXG4gIElSZXNvbHZlcixcclxufSBmcm9tICcuLi8uLi9tb2RlbHMnO1xyXG5pbXBvcnQgeyBBeGlzUmVzb2x2ZXIgfSBmcm9tICcuL2F4aXMtcmVzb2x2ZXInO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlc29sdmVyKHtcclxuICB3aW5kb3dFbGVtZW50LFxyXG4gIGF4aXMsXHJcbn06IElQb3NpdGlvbkVsZW1lbnRzKTogSVJlc29sdmVyIHtcclxuICByZXR1cm4gY3JlYXRlUmVzb2x2ZXJXaXRoQ29udGFpbmVyKFxyXG4gICAgeyBheGlzLCBpc1dpbmRvdzogaXNFbGVtZW50V2luZG93KHdpbmRvd0VsZW1lbnQpIH0sXHJcbiAgICB3aW5kb3dFbGVtZW50XHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlc29sdmVyV2l0aENvbnRhaW5lcihcclxuICByZXNvbHZlcjogYW55LFxyXG4gIHdpbmRvd0VsZW1lbnQ6IENvbnRhaW5lclJlZlxyXG4pIHtcclxuICBjb25zdCBjb250YWluZXIgPVxyXG4gICAgcmVzb2x2ZXIuaXNXaW5kb3cgfHwgKHdpbmRvd0VsZW1lbnQgJiYgIXdpbmRvd0VsZW1lbnQubmF0aXZlRWxlbWVudClcclxuICAgICAgPyB3aW5kb3dFbGVtZW50XHJcbiAgICAgIDogd2luZG93RWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gIHJldHVybiB7IC4uLnJlc29sdmVyLCBjb250YWluZXIgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRWxlbWVudFdpbmRvdyh3aW5kb3dFbGVtZW50OiBDb250YWluZXJSZWYpOiBib29sZWFuIHtcclxuICBjb25zdCBpc1dpbmRvdyA9IFsnV2luZG93JywgJ2dsb2JhbCddLnNvbWUoKG9iajogc3RyaW5nKSA9PlxyXG4gICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvd0VsZW1lbnQpLmluY2x1ZGVzKG9iailcclxuICApO1xyXG4gIHJldHVybiBpc1dpbmRvdztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldERvY3VtZW50RWxlbWVudChcclxuICBpc0NvbnRhaW5lcldpbmRvdzogYm9vbGVhbixcclxuICB3aW5kb3dFbGVtZW50OiBhbnlcclxuKSB7XHJcbiAgcmV0dXJuIGlzQ29udGFpbmVyV2luZG93ID8gd2luZG93RWxlbWVudC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUG9pbnRzKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHJlc29sdmVyOiBJUmVzb2x2ZXIpIHtcclxuICBjb25zdCBoZWlnaHQgPSBleHRyYWN0SGVpZ2h0Rm9yRWxlbWVudChyZXNvbHZlcik7XHJcbiAgcmV0dXJuIHJlc29sdmVyLmlzV2luZG93XHJcbiAgICA/IGNhbGN1bGF0ZVBvaW50c0ZvcldpbmRvdyhoZWlnaHQsIGVsZW1lbnQsIHJlc29sdmVyKVxyXG4gICAgOiBjYWxjdWxhdGVQb2ludHNGb3JFbGVtZW50KGhlaWdodCwgZWxlbWVudCwgcmVzb2x2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUG9pbnRzRm9yV2luZG93KFxyXG4gIGhlaWdodDogbnVtYmVyLFxyXG4gIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXHJcbiAgcmVzb2x2ZXI6IElSZXNvbHZlclxyXG4pOiBJUG9zaXRpb25TdGF0cyB7XHJcbiAgY29uc3QgeyBheGlzLCBjb250YWluZXIsIGlzV2luZG93IH0gPSByZXNvbHZlcjtcclxuICBjb25zdCB7IG9mZnNldEhlaWdodEtleSwgY2xpZW50SGVpZ2h0S2V5IH0gPSBleHRyYWN0SGVpZ2h0UHJvcEtleXMoYXhpcyk7XHJcbiAgLy8gc2Nyb2xsZWQgdW50aWwgbm93IC8gY3VycmVudCB5IHBvaW50XHJcbiAgY29uc3Qgc2Nyb2xsZWQgPVxyXG4gICAgaGVpZ2h0ICtcclxuICAgIGdldEVsZW1lbnRQYWdlWU9mZnNldChcclxuICAgICAgZ2V0RG9jdW1lbnRFbGVtZW50KGlzV2luZG93LCBjb250YWluZXIpLFxyXG4gICAgICBheGlzLFxyXG4gICAgICBpc1dpbmRvd1xyXG4gICAgKTtcclxuICAvLyB0b3RhbCBoZWlnaHQgLyBtb3N0IGJvdHRvbSB5IHBvaW50XHJcbiAgY29uc3QgbmF0aXZlRWxlbWVudEhlaWdodCA9IGdldEVsZW1lbnRIZWlnaHQoXHJcbiAgICBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQsXHJcbiAgICBpc1dpbmRvdyxcclxuICAgIG9mZnNldEhlaWdodEtleSxcclxuICAgIGNsaWVudEhlaWdodEtleVxyXG4gICk7XHJcbiAgY29uc3QgdG90YWxUb1Njcm9sbCA9XHJcbiAgICBnZXRFbGVtZW50T2Zmc2V0VG9wKGVsZW1lbnQubmF0aXZlRWxlbWVudCwgYXhpcywgaXNXaW5kb3cpICtcclxuICAgIG5hdGl2ZUVsZW1lbnRIZWlnaHQ7XHJcbiAgcmV0dXJuIHsgaGVpZ2h0LCBzY3JvbGxlZCwgdG90YWxUb1Njcm9sbCwgaXNXaW5kb3cgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVBvaW50c0ZvckVsZW1lbnQoXHJcbiAgaGVpZ2h0OiBudW1iZXIsXHJcbiAgZWxlbWVudDogRWxlbWVudFJlZixcclxuICByZXNvbHZlcjogSVJlc29sdmVyXHJcbik6IElQb3NpdGlvblN0YXRzIHtcclxuICBjb25zdCB7IGF4aXMsIGNvbnRhaW5lciB9ID0gcmVzb2x2ZXI7XHJcbiAgLy8gcGVyaGFwcyB1c2UgY29udGFpbmVyLm9mZnNldFRvcCBpbnN0ZWFkIG9mICdzY3JvbGxUb3AnXHJcbiAgY29uc3Qgc2Nyb2xsZWQgPSBjb250YWluZXJbYXhpcy5zY3JvbGxUb3BLZXkoKV07XHJcbiAgY29uc3QgdG90YWxUb1Njcm9sbCA9IGNvbnRhaW5lcltheGlzLnNjcm9sbEhlaWdodEtleSgpXTtcclxuICByZXR1cm4geyBoZWlnaHQsIHNjcm9sbGVkLCB0b3RhbFRvU2Nyb2xsLCBpc1dpbmRvdzogZmFsc2UgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RIZWlnaHRQcm9wS2V5cyhheGlzOiBBeGlzUmVzb2x2ZXIpIHtcclxuICByZXR1cm4ge1xyXG4gICAgb2Zmc2V0SGVpZ2h0S2V5OiBheGlzLm9mZnNldEhlaWdodEtleSgpLFxyXG4gICAgY2xpZW50SGVpZ2h0S2V5OiBheGlzLmNsaWVudEhlaWdodEtleSgpLFxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0SGVpZ2h0Rm9yRWxlbWVudCh7XHJcbiAgY29udGFpbmVyLFxyXG4gIGlzV2luZG93LFxyXG4gIGF4aXMsXHJcbn06IElSZXNvbHZlcikge1xyXG4gIGNvbnN0IHsgb2Zmc2V0SGVpZ2h0S2V5LCBjbGllbnRIZWlnaHRLZXkgfSA9IGV4dHJhY3RIZWlnaHRQcm9wS2V5cyhheGlzKTtcclxuICByZXR1cm4gZ2V0RWxlbWVudEhlaWdodChcclxuICAgIGNvbnRhaW5lcixcclxuICAgIGlzV2luZG93LFxyXG4gICAgb2Zmc2V0SGVpZ2h0S2V5LFxyXG4gICAgY2xpZW50SGVpZ2h0S2V5XHJcbiAgKTtcclxufVxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudEhlaWdodChcclxuICBlbGVtOiBhbnksXHJcbiAgaXNXaW5kb3c6IGJvb2xlYW4sXHJcbiAgb2Zmc2V0SGVpZ2h0S2V5OiBzdHJpbmcsXHJcbiAgY2xpZW50SGVpZ2h0S2V5OiBzdHJpbmdcclxuKSB7XHJcbiAgaWYgKGlzTmFOKGVsZW1bb2Zmc2V0SGVpZ2h0S2V5XSkpIHtcclxuICAgIGNvbnN0IGRvY0VsZW0gPSBnZXREb2N1bWVudEVsZW1lbnQoaXNXaW5kb3csIGVsZW0pO1xyXG4gICAgcmV0dXJuIGRvY0VsZW0gPyBkb2NFbGVtW2NsaWVudEhlaWdodEtleV0gOiAwO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gZWxlbVtvZmZzZXRIZWlnaHRLZXldO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRPZmZzZXRUb3AoXHJcbiAgZWxlbTogQ29udGFpbmVyUmVmLFxyXG4gIGF4aXM6IEF4aXNSZXNvbHZlcixcclxuICBpc1dpbmRvdzogYm9vbGVhblxyXG4pIHtcclxuICBjb25zdCB0b3BLZXkgPSBheGlzLnRvcEtleSgpO1xyXG4gIC8vIGVsZW0gPSBlbGVtLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgaWYgKCFlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCkge1xyXG4gICAgLy8gfHwgZWxlbS5jc3MoJ25vbmUnKSkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICByZXR1cm4gKFxyXG4gICAgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVt0b3BLZXldICtcclxuICAgIGdldEVsZW1lbnRQYWdlWU9mZnNldChlbGVtLCBheGlzLCBpc1dpbmRvdylcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudFBhZ2VZT2Zmc2V0KFxyXG4gIGVsZW06IENvbnRhaW5lclJlZixcclxuICBheGlzOiBBeGlzUmVzb2x2ZXIsXHJcbiAgaXNXaW5kb3c6IGJvb2xlYW5cclxuKSB7XHJcbiAgY29uc3QgcGFnZVlPZmZzZXQgPSBheGlzLnBhZ2VZT2Zmc2V0S2V5KCk7XHJcbiAgY29uc3Qgc2Nyb2xsVG9wID0gYXhpcy5zY3JvbGxUb3BLZXkoKTtcclxuICBjb25zdCBvZmZzZXRUb3AgPSBheGlzLm9mZnNldFRvcEtleSgpO1xyXG5cclxuICBpZiAoaXNOYU4od2luZG93LnBhZ2VZT2Zmc2V0KSkge1xyXG4gICAgcmV0dXJuIGdldERvY3VtZW50RWxlbWVudChpc1dpbmRvdywgZWxlbSlbc2Nyb2xsVG9wXTtcclxuICB9IGVsc2UgaWYgKGVsZW0ub3duZXJEb2N1bWVudCkge1xyXG4gICAgcmV0dXJuIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlld1twYWdlWU9mZnNldF07XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBlbGVtW29mZnNldFRvcF07XHJcbiAgfVxyXG59XHJcbiJdfQ==